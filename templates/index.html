{% extends "base.html" %}
{% block content %}

<div class="topbar">
  <a href="{{ url_for('index', year=prev_year, month=prev_month) }}">â† ä¸Šä¸€æœˆ</a>
  <h3 style="margin:0;">{{ year }} å¹´ {{ "%02d"|format(month) }} æœˆ</h3>
  <a href="{{ url_for('index', year=next_year, month=next_month) }}">ä¸‹ä¸€æœˆ â†’</a>
</div>

<!-- å…¨åŸŸæ¯æ—¥ç‡Ÿé¤Šç›®æ¨™ æ‘˜è¦ + é€²å…¥è¨­å®šé æŒ‰éˆ• -->
<section style="margin-bottom:1rem;">
  <h4>å…¨åŸŸæ¯æ—¥ç‡Ÿé¤Šç›®æ¨™</h4>
  {% if nutrition_goal %}
    <p>
      ç›®å‰ç›®æ¨™ï¼š
      ç†±é‡ {{ '%.0f'|format(nutrition_goal.kcal_target) }} kcalï¼Œ
      ç¢³æ°´ {{ '%.1f'|format(nutrition_goal.carb_target) }} gï¼Œ
      è›‹ç™½è³ª {{ '%.1f'|format(nutrition_goal.protein_target) }} gï¼Œ
      è„‚è‚ª {{ '%.1f'|format(nutrition_goal.fat_target) }} g
    </p>
  {% else %}
    <p class="muted">å°šæœªè¨­å®šå…¨åŸŸç›®æ¨™ã€‚</p>
  {% endif %}

  <!-- åŸæœ¬åªæœ‰ä¸€å€‹æŒ‰éˆ•ï¼Œæ”¹æˆå…©å€‹æ’åœ¨ä¸€èµ· -->
  <div style="display:flex; gap:.75rem; flex-wrap:wrap; align-items:center; margin-top:.25rem;">
    <a href="{{ url_for('nutrition_goal_page') }}" role="button">
      è¨­å®š / ä¿®æ”¹å…¨åŸŸæ¯æ—¥ç‡Ÿé¤Šç›®æ¨™
    </a>
    <a href="https://taiming20030.wixsite.com/taiwantechsmap"
       target="_blank" rel="noopener"
       role="button" class="contrast">
      æ ¡åœ’åœ°åœ–
    </a>
    <a href="{{ url_for('timetable') }}" role="button" class="secondary">
      èª²è¡¨
    </a>
    <!-- æ–°å¢ï¼šé‡è¦äº‹é …æŒ‰éˆ• -->
    <a href="{{ url_for('important') }}" role="button" class="secondary">
      é‡è¦äº‹é …
    </a>
    <a href="{{ url_for('weight_page') }}" role="button" class="secondary">
      é«”é‡ç´€éŒ„
    </a>
    <!-- æ–°å¢ï¼šæœ€è¿‘é‡è¦äº‹é …å€’æ•¸é¡¯ç¤º -->
    <span class="muted" style="font-size:0.9rem;">
      {% if next_important %}
        æœ€è¿‘ï¼š{{ next_important.title }}ï¼ˆé‚„æœ‰ {{ next_important_days }} å¤©ï¼‰
      {% else %}
        ç›®å‰æ²’æœ‰å·²è¨­å®šçš„é‡è¦äº‹é …
      {% endif %}
    </span>
  </div>
</section>

<div class="header">
  <div>ä¸€</div><div>äºŒ</div><div>ä¸‰</div><div>å››</div><div>äº”</div><div>å…­</div><div>æ—¥</div>
</div>

<div class="calendar">
  {% for week in weeks %}
    {% for d in week %}
      {% set is_this_month = (d.month == month) %}
      {% set classes = "day" %}
      {% if d == today %}{% set classes = classes + " today" %}{% endif %}
      <div class="{{ classes }}">
        <div class="datebox">
          <a href="{{ url_for('day_view', datestr=d.strftime('%Y-%m-%d')) }}"
             class="{{ '' if is_this_month else 'muted' }}">{{ d.day }}</a>
          <div style="display:flex; gap:.35rem; align-items:center;">
            {% if d in strength_dates %}
              <span class="strength-dot" title="ä»Šæ—¥æœ‰é‡è¨“">ğŸ‹ï¸</span>
            {% endif %}
            <!-- åªä¿ç•™å¿«é€Ÿæ–°å¢çš„ ï¼‹ æŒ‰éˆ• -->
            <a href="{{ url_for('add', date=d.strftime('%Y-%m-%d')) }}" class="muted">ï¼‹</a>
          </div>
        </div>

        <!-- ä¸»é åªé¡¯ç¤ºç°¡å–®è³‡è¨Šï¼Œä¸æä¾›ç·¨è¼¯/åˆªé™¤æŒ‰éˆ• -->
        {% for it in items_by_date.get(d, []) %}
          <div class="item">
            <span class="badge">{{ it.item_type }}</span>
            <div class="item-title">{{ it.title }}</div>
            <div><small>{{ it.time_range_str() }}</small></div>
            {% if it.content %}
              <div style="font-size:.85rem; color:#4b5563;">
                {{ it.content|truncate(60) }}
              </div>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    {% endfor %}
  {% endfor %}
</div>

{% endblock %}
