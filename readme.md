-----

# ğŸ“… Flask Super Calendar | å…¨æ–¹ä½å€‹äººç®¡ç†ç³»çµ±

é€™æ˜¯ä¸€å€‹æ•´åˆè¡Œäº‹æ›†ã€å¥åº·è¿½è¹¤èˆ‡ç”Ÿæ´»ç´€éŒ„çš„ Web æ‡‰ç”¨ç¨‹å¼ã€‚æ¡ç”¨ Python Flask é–‹ç™¼ï¼Œæ”¯æ´å¤šäººç™»å…¥ç³»çµ±èˆ‡ Docker å®¹å™¨åŒ–éƒ¨ç½²ã€‚

   

-----

## âœ¨ åŠŸèƒ½äº®é» (Features)

| æ¨¡çµ„ | åŠŸèƒ½æè¿° |
| :--- | :--- |
| **ğŸ” èº«åˆ†é©—è­‰** | æ”¯æ´ **Google / LINE** å¿«é€Ÿç™»å…¥ï¼Œå…·å‚™å¸³è™Ÿè‡ªå‹•é—œè¯ (Account Linking) åŠŸèƒ½ã€‚ |
| **ğŸ“… è¡Œäº‹æ›†** | æœˆæª¢è¦–ã€é€±æª¢è¦–ã€æ—¥æª¢è¦–åˆ‡æ›ï¼Œæ”¯æ´å¤šç¨®äº‹é …åˆ†é¡ã€‚ |
| **ğŸ± é£²é£Ÿè¿½è¹¤** | ç´€éŒ„æ¯æ—¥ç‡Ÿé¤Šç´ ï¼Œè¼¸å…¥æ™‚æä¾› **æ­·å²ç´€éŒ„è‡ªå‹•å®Œæˆ (Auto-complete)** å»ºè­°ã€‚ |
| **ğŸ’ª é‡è¨“æ—¥èªŒ** | ç´€éŒ„éƒ¨ä½ã€å‹•ä½œã€é‡é‡ï¼Œè‡ªå‹•è¨ˆç®— **PR (æœ€é«˜ç´€éŒ„)** ä¸¦ç¹ªè£½ **é€²æ­¥æŠ˜ç·šåœ–**ã€‚ |
| **âš–ï¸ é«”é‡ç®¡ç†** | æ¯æ—¥é«”é‡ç´€éŒ„èˆ‡è¶¨å‹¢åœ–è¡¨åˆ†æã€‚ |
| **ğŸ“ ç”Ÿæ´»æ—¥è¨˜** | æ•´åˆ **Trix Editor** å¯Œæ–‡æœ¬ç·¨è¼¯å™¨ï¼Œæ”¯æ´åœ–æ–‡æ’ç‰ˆã€‚ |
| **ğŸ“ èª²è¡¨ç³»çµ±** | è¦–è¦ºåŒ–èª²è¡¨ï¼Œæ”¯æ´ç¯€æ¬¡åˆä½µé¡¯ç¤ºã€‚ |

-----

## âš™ï¸ ç’°å¢ƒè®Šæ•¸è¨­å®š (.env)

æœ¬å°ˆæ¡ˆä¾è³´ç’°å¢ƒè®Šæ•¸ä¾†ç®¡ç†æ•æ„Ÿè³‡è¨Šã€‚è«‹åœ¨å°ˆæ¡ˆæ ¹ç›®éŒ„å»ºç«‹ `.env` æª”æ¡ˆã€‚

### `.env` ç¯„ä¾‹æª”

```ini
# ==========================================
# æ ¸å¿ƒå®‰å…¨è¨­å®š
# ==========================================
# è«‹å‹™å¿…è¨­å®šä¸€å€‹éš¨æ©Ÿçš„äº‚ç¢¼ï¼Œç”¨æ–¼åŠ å¯† Session å’Œ Cookie
SECRET_KEY=your-super-secret-random-key-change-this

# é–‹ç™¼ç’°å¢ƒè¨­å®š
# 1 = å…è¨±åœ¨æ²’æœ‰ HTTPS çš„æƒ…æ³ä¸‹ä½¿ç”¨ OAuth (æœ¬åœ°é–‹ç™¼/Tunnel æ¸¬è©¦ç”¨)
# æ­£å¼ä¸Šç·š (æœ‰ SSL) è«‹ç§»é™¤æ­¤è¡Œæˆ–è¨­ç‚º 0
OAUTHLIB_INSECURE_TRANSPORT=1

# ==========================================
# Google Login è¨­å®š
# ç”³è«‹ç¶²å€: https://console.cloud.google.com/
# ==========================================
GOOGLE_CLIENT_ID=ä½ çš„_Google_Client_ID
GOOGLE_CLIENT_SECRET=ä½ çš„_Google_Client_Secret

# ==========================================
# LINE Login è¨­å®š
# ç”³è«‹ç¶²å€: https://developers.line.biz/
# ==========================================
LINE_CLIENT_ID=ä½ çš„_Channel_ID
LINE_CLIENT_SECRET=ä½ çš„_Channel_Secret
```

> **âš ï¸ æ³¨æ„ï¼šCallback URL è¨­å®š**
> åœ¨ Google èˆ‡ LINE çš„é–‹ç™¼è€…å¾Œå°ï¼Œè«‹å°‡ Callback URL è¨­å®šç‚ºï¼š
>
>   * **Google**: `https://ä½ çš„ç¶²åŸŸ/auth/google/callback`
>   * **LINE**: `https://ä½ çš„ç¶²åŸŸ/auth/line/callback`
>
> *è‹¥ä½¿ç”¨ Cloudflare Tunnel æˆ– Dev Tunnelsï¼Œè«‹å¡«å¯«éš¨æ©Ÿç”Ÿæˆçš„é‚£å€‹ HTTPS ç¶²å€ã€‚*

-----

## ğŸš€ æœ¬åœ°é–‹ç™¼æ•™å­¸ (Local Development)

### 1\. å–å¾—ç¨‹å¼ç¢¼

```bash
git clone https://github.com/your-username/super-calendar.git
cd super-calendar
```

### 2\. å»ºç«‹è™›æ“¬ç’°å¢ƒ

å»ºè­°ä½¿ç”¨ `venv` ä¾†éš”é›¢é–‹ç™¼ç’°å¢ƒï¼š

```bash
# å»ºç«‹ venv
python3 -m venv venv

# å•Ÿå‹• venv (Linux/Mac)
source venv/bin/activate

# å•Ÿå‹• venv (Windows)
venv\Scripts\activate
```

### 3\. å®‰è£ä¾è³´å¥—ä»¶

```bash
pip install -r requirements.txt
```

### 4\. åˆå§‹åŒ–èˆ‡å•Ÿå‹•

```bash
# é¦–æ¬¡åŸ·è¡Œæœƒè‡ªå‹•åœ¨ instance/ è³‡æ–™å¤¾å»ºç«‹ calendar.db
python app.py
```

æ‰“é–‹ç€è¦½å™¨å‰å¾€ï¼š`http://127.0.0.1:5000`

-----

## ğŸ³ Docker éƒ¨ç½²æ•™å­¸ (Deployment)

æœ¬å°ˆæ¡ˆå·²å®Œå…¨å®¹å™¨åŒ–ï¼Œæ”¯æ´ Gunicorn é«˜æ•ˆèƒ½éƒ¨ç½²ã€‚

### 1\. å»ºç½®æ˜ åƒæª” (Build)

```bash
docker build -t super-calendar .
```

### 2\. å•Ÿå‹•å®¹å™¨ (Run)

æ­¤æŒ‡ä»¤æœƒå°‡è³‡æ–™åº«æ›è¼‰åˆ°æœ¬æ©Ÿï¼Œç¢ºä¿è³‡æ–™ä¸æœƒå› å®¹å™¨é‡å•Ÿè€Œæ¶ˆå¤±ã€‚

```bash
docker run -d \
  --name calendar-app \
  --restart always \
  -p 5000:5000 \
  -v $(pwd)/instance:/app/instance \
  --env-file .env \
  super-calendar
```

  * **`-p 5000:5000`**: å°‡å®¹å™¨çš„ 5000 åŸ å°æ‡‰åˆ°ä¸»æ©Ÿã€‚
  * **`-v .../instance`**: **é‡è¦ï¼** è³‡æ–™æŒä¹…åŒ–ï¼Œå°‡è³‡æ–™åº«å­˜æ”¾åœ¨ä¸»æ©Ÿç«¯ã€‚
  * **`--env-file .env`**: ç›´æ¥è®€å–ä½ çš„ `.env` æª”æ¡ˆè¨­å®šã€‚

-----

## ğŸ› ï¸ å¸¸è¦‹å•é¡Œæ’é™¤ (Troubleshooting)

### Q1: LINE Login é¡¯ç¤º `UnsupportedAlgorithmError` æˆ– `Key not found`ï¼Ÿ

  * **åŸå› **ï¼šLINE ä½¿ç”¨ ES256 åŠ å¯†ç®—æ³•ï¼Œèˆ‡æŸäº›ç’°å¢ƒçš„ `Authlib` è‡ªå‹•åµæ¸¬ä¸ç›¸å®¹ã€‚
  * **è§£æ³•**ï¼šæœ¬å°ˆæ¡ˆå·²æ”¹å¯« `app.py` ä¸­çš„ `line_auth` å‡½å¼ï¼Œä½¿ç”¨ `requests` æ‰‹å‹•ç™¼é€è«‹æ±‚ä¸¦æ‰‹å‹•è§£ç¢¼ Tokenï¼Œç¹éäº†å¥—ä»¶ç›¸å®¹æ€§å•é¡Œã€‚è«‹ç¢ºä¿ä½ çš„ç¨‹å¼ç¢¼æ˜¯æœ€æ–°çš„ã€‚

### Q2: ç™»å…¥å¾Œè¢«è½‰å°å› `http` è€Œä¸æ˜¯ `https`ï¼Ÿ

  * **åŸå› **ï¼šFlask èº²åœ¨ Tunnel æˆ– Proxy å¾Œé¢ï¼Œä¸çŸ¥é“å¤–é¢æ˜¯ HTTPSã€‚
  * **è§£æ³•**ï¼šç¨‹å¼ç¢¼ä¸­å·²åŠ å…¥ `ProxyFix` Middleware è¨­å®šï¼š
    ```python
    from werkzeug.middleware.proxy_fix import ProxyFix
    app.wsgi_app = ProxyFix(app.wsgi_app, x_proto=1, x_host=1)
    ```

### Q3: ç‚ºä»€éº¼çœ‹ä¸åˆ°éšŠå‹çš„è³‡æ–™ï¼Ÿ

  * **è¨­è¨ˆæ©Ÿåˆ¶**ï¼šç³»çµ±å·²å¯¦ä½œ **å¤šä½¿ç”¨è€…æ¬Šé™éš”é›¢**ã€‚æ‰€æœ‰è³‡æ–™åº«æŸ¥è©¢çš†åŠ ä¸Šäº† `filter_by(user_id=current_user.id)`ï¼Œç¢ºä¿æ¯ä½ä½¿ç”¨è€…åªèƒ½çœ‹è¦‹è‡ªå·±çš„è³‡æ–™ã€‚

-----

## ğŸ“‚ å°ˆæ¡ˆçµæ§‹

```text
super-calendar/
â”œâ”€â”€ app.py              # æ ¸å¿ƒå¾Œç«¯é‚è¼¯ (Routes, Models, Config)
â”œâ”€â”€ requirements.txt    # å¥—ä»¶ä¾è³´æ¸…å–®
â”œâ”€â”€ Dockerfile          # Docker å»ºç½®è—åœ–
â”œâ”€â”€ .env                # ç’°å¢ƒè®Šæ•¸ (ä¸åœ¨æ­¤ Repo ä¸­ï¼Œéœ€è‡ªè¡Œå»ºç«‹)
â”œâ”€â”€ instance/
â”‚   â””â”€â”€ calendar.db     # SQLite è³‡æ–™åº« (è‡ªå‹•ç”Ÿæˆ)
â”œâ”€â”€ static/
â”‚   â”œâ”€â”€ css/            # è‡ªå®šç¾©æ¨£å¼ (style.css)
â”‚   â””â”€â”€ js/             # å‰ç«¯é‚è¼¯ (diet_suggest.js)
â””â”€â”€ templates/          # HTML æ¨¡æ¿
    â”œâ”€â”€ base.html       # åŸºç¤ç‰ˆå‹ (å« Navbar)
    â”œâ”€â”€ index.html      # æœˆæª¢è¦–
    â”œâ”€â”€ day.html        # æ—¥æª¢è¦– (æ—¥è¨˜ã€é‡è¨“ã€é£²é£Ÿ)
    â”œâ”€â”€ login.html      # ç™»å…¥é 
    â””â”€â”€ ...
```